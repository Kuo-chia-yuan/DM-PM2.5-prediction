# -*- coding: utf-8 -*-
"""DM_hw1.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1GIBBVYjDrBUjDTaoxqRU-D5BjTvywb-Q
"""

import pandas as pd
import numpy as np
from sklearn.linear_model import LinearRegression
from sklearn.metrics import mean_squared_error
from sklearn.preprocessing import StandardScaler

# 讀取CSV檔案
data = pd.read_csv('train.csv')
data.iloc[:, 3:27] = data.iloc[:, 3:27].apply(pd.to_numeric, errors='coerce').fillna(0)
data.iloc[:, 3:27] = data.iloc[:, 3:27].astype(float)

input = []
output = []

for i in range(9, 4320, 18):
  input.append(data.iloc[i, 15:24])
  output.append(data.iloc[i, 24])

# 將input轉換為NumPy數組
input = np.array(input)
output = np.array(output)

# 使用StandardScaler進行Z-score正規化
scaler_input = StandardScaler()
scaler_output = StandardScaler()

# 對input和output進行擬合和轉換
input_scaled = scaler_input.fit_transform(input)
output_scaled = scaler_output.fit_transform(output.reshape(-1, 1))

# 將input和output轉換回原始形狀
input = input_scaled.tolist()
output = output.flatten().tolist()

print(input)

model = LinearRegression()

model.fit(input, output)

test_data = pd.read_csv('test.csv')
test_data.iloc[:, 2:11] = test_data.iloc[:, 2:11].apply(pd.to_numeric, errors='coerce').fillna(0)
test_data.iloc[:, 2:11] = test_data.iloc[:, 2:11].astype(float)

test_input = []
for i in range(8, 4391, 18):
  test_input.append(test_data.iloc[i, 2:11])

predictions = model.predict(test_input)

predictions_df = pd.DataFrame(predictions, columns=['Predictions'])

predictions_df = pd.DataFrame({
    'index': [f'index_{i}' for i in range(len(predictions_df))],
    'answer': predictions
})

predictions_df.to_csv('predictions.csv', index=False)

model = LinearRegression()

model.fit(input, output)

predictions = model.predict(input)

mse = mean_squared_error(output, predictions)

rmse = np.sqrt(mse)

print("RMSE:", rmse)